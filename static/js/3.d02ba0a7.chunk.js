(this.webpackJsonpcboard=this.webpackJsonpcboard||[]).push([[3],{1895:function(e,t,n){"use strict";n.r(t),n.d(t,"getDataUri",(function(){return K})),n.d(t,"openboardExportAdapter",(function(){return Q})),n.d(t,"openboardExportOneAdapter",(function(){return $})),n.d(t,"openboardExportManyAdapter",(function(){return te})),n.d(t,"cboardExportAdapter",(function(){return ae})),n.d(t,"pdfExportAdapter",(function(){return ie}));var r=n(1),a=n(2),o=n.n(a),i=n(25),c=n(12),s=n(69),u=n(1883),l=n.n(u),d=n(235),p=n.n(d),f=n(141),h=n.n(f),b=n(1884),g=n.n(b),m=n(1885),v=n.n(m),w=n(1886),y=n(477),x=n(44),k=n(14),j=n(160),O=n(237),A=n(1887),C=n.n(A),E=n(1890),S=n.n(E),B=n(320);g.a.vfs=v.a.pdfMake.vfs;var _=new Image;function W(e){var t=e.replace(/([A-Z])/g,(function(e){return"_"+e.toLowerCase()}));return t.startsWith("_")?t.slice(1):t}function M(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n={},r=y.c.filter((function(t){return!!e[t]}));r.forEach((function(t){var r="".concat(y.b).concat(W(t));n[r]=e[t]}));var a=e.label||e.labelKey||"";return n.label=a.length?t.formatMessage({id:a}):a,e.action&&(n.action=e.action),e.vocalization&&(n.vocalization=e.vocalization),e.borderColor&&(n.border_color=e.borderColor),e.backgroundColor&&(n.background_color=e.backgroundColor),n}function P(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(","),n=Object(s.a)(t,2),r=n[0],a=n[1],o=r.split(":")[1].split(";")[0],i=atob(a),c=new ArrayBuffer(i.length),u=new Uint8Array(c),l=0;l<i.length;l++)u[l]=i.charCodeAt(l);return{ab:c,data:e,content_type:o}}function K(e){return D.apply(this,arguments)}function D(){return(D=Object(c.a)(o.a.mark((function e(t){var n,r,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p()({method:"get",url:t,responseType:"arraybuffer"});case 3:return n=e.sent,r=btoa(new Uint8Array(n.data).reduce((function(e,t){return e+String.fromCharCode(t)}),"")),a=n.headers["content-type"],e.abrupt("return",{ab:n.data,content_type:a,data:"data:".concat(a,";base64,").concat(r)});case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to get image at ".concat(t,"."),e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function R(e){return U.apply(this,arguments)}function U(){return(U=Object(c.a)(o.a.mark((function e(t){var n,a,i,s,u,l,d,p,f,h,b,g,m,v=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:{},a=v.length>2?v[2]:void 0,i=v.length>3?v[3]:void 0,s=i.embed,u=void 0!==s&&s,n.tiles&&!(n.tiles.length<1)){e.next=5;break}return e.abrupt("return",{obf:null,images:null});case 5:return l={},d={},p=new Array(Math.ceil(n.tiles.length/y.a)),f=0,e.next=11,Promise.all(n.tiles.map(function(){var e=Object(c.a)(o.a.mark((function e(i,c){var s,h,b,g,m,v,w;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=c>=(f+1)*y.a?f+1:f,!i){e.next=19;break}if(p[f]?p[f].push(i.id):p[f]=[i.id],s=Object(r.a)({id:i.id},M(i,a)),!i.image||!i.image.length){e.next=17;break}if(!(h=Object(k.d)()&&i.image&&0===i.image.search("/")?".".concat(i.image):i.image).startsWith("data:")){e.next=10;break}e.t0=P(h),e.next=13;break;case 10:return e.next=12,K(h);case 12:e.t0=e.sent;case 13:b=e.t0,g=function(){var e=["custom",n.name||n.nameKey,i.label||i.labelKey||i.id],t=C.a.extension(b.content_type);return"/".concat(O.join(e,"/"),".").concat(t)},m=h.startsWith("data:")?g():Object(k.d)()?"":h.startsWith("/")?h:"/".concat(h),b&&(v=(new S.a.Types.ObjectId).toString(),d[v]=O.defaults({path:m},b),s.image_id=v,l[v]={id:v,path:u?void 0:m,data:u?b.data:void 0,content_type:b.content_type,width:300,height:300});case 17:return i.loadBoard&&t[i.loadBoard]&&(w=t[i.loadBoard],s.load_board={name:w.nameKey?a.formatMessage({id:w.nameKey}):"",path:"boards/".concat(i.loadBoard,".obf")}),e.abrupt("return",s);case 19:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 11:if(h=e.sent,!(p.length>=1)){e.next=21;break}return(b=y.a-p[p.length-1].length)>0&&(g=new Array(b).map((function(){return null})),p[p.length-1]=p[p.length-1].concat(g)),m={format:"open-board-0.1",id:n.id,locale:a.locale,name:n.name,url:"".concat(y.d.URL).concat(n.id),license:y.d.LICENSE,images:Object.values(l),buttons:h,sounds:[],grid:{rows:p.length,columns:y.a,order:p},description_html:n.nameKey?a.formatMessage({id:n.nameKey}):""},y.c.filter((function(e){return"undefined"!==typeof n[e]})).forEach((function(e){var t="".concat(y.b).concat(W(e));m[t]=n[e]})),e.abrupt("return",{obf:m,images:d});case 21:return e.abrupt("return",{obf:null,images:null});case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,t){var n=e.label||e.labelKey||"";return{label:n.length?t.formatMessage({id:n}):n,image:e.image||""}}function L(e){return N.apply(this,arguments)}function N(){return(N=Object(c.a)(o.a.mark((function e(t){var n,r,a=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},r=a.length>2&&void 0!==a[2]?a[2]:"image/jpeg",e.abrupt("return",new Promise((function(e,a){_.crossOrigin="Anonymous",_.onload=function(){var t=document.createElement("CANVAS"),a=t.getContext("2d"),o=n.backgroundColor||"white",i=n.borderColor||null;t.height=150,t.width=150,a.fillStyle=o,a.fillRect(0,0,t.width,t.height),i&&(a.strokeStyle=i,a.lineWidth=2,a.strokeRect(0,0,t.width,t.height));var c=1,s=1;(this.naturalWidth>150||this.naturalHeight>150)&&(c=150/this.naturalWidth,s=150/this.naturalHeight),a.drawImage(this,0,0,this.naturalWidth*c,this.naturalHeight*s),i&&(a.strokeStyle=i,a.lineWidth=3,a.strokeRect(0,0,150,150));var u=t.toDataURL(r);e(u)},_.onerror=function(){a(new Error("Getting remote image failed"))};var o=Object(k.d)()&&t&&0===t.search("/")?".".concat(t):t;_.src=t?o:y.g,(_.complete||void 0===_.complete)&&(_.src=t?o:y.g)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){return z.apply(this,arguments)}function z(){return(z=Object(c.a)(o.a.mark((function e(t,n){var r,a,i,c,s,u,l,d,p=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!(p.length>2&&void 0!==p[2])||p[2],a=t.name||"",i=t.isFixed&&t.grid?t.grid.columns:y.a,c=t.isFixed&&t.grid?t.grid.rows:y.e,s={table:{widths:"*",body:[{}]},layout:"noBorders"},r&&(s.pageBreak="after"),t.tiles&&t.tiles.length){e.next=8;break}return e.abrupt("return",[a,s]);case 8:if(!t.isFixed){e.next=14;break}return e.next=11,F(t,c,i,n,s);case 11:e.t0=e.sent,e.next=17;break;case 14:return e.next=16,T(t,c,i,n,s);case 16:e.t0=e.sent;case 17:return u=e.t0,(l=i-u[u.length-2].length)>0&&(d=new Array(l).fill(""),u[u.length-2]=u[u.length-2].concat(d),u[u.length-1]=u[u.length-1].concat(d)),s.table.body=u,e.abrupt("return",[a,s]);case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e,t){for(var n=Object(i.a)(e),r=[];n.length;)r.push(n.splice(0,t));return r}function F(e,t,n,r){return I.apply(this,arguments)}function I(){return(I=Object(c.a)(o.a.mark((function e(t,n,r,a){var i,c,s,u,l,d,p,f,h,b,g,m;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0,c=0,s={label:"",labelKey:"",image:"",backgroundColor:"#d9d9d9"},u=n*r,l=H(t.tiles,u),d=new Array(2*t.grid.rows*l.length),p=0;case 7:if(!(p<l.length)){e.next=25;break}f=l[p],h=B.a({columns:r,rows:n,order:t.grid.order,items:f}),b=0;case 11:if(!(b<h.length)){e.next=22;break}g=o.a.mark((function e(u){var p,f,g;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p=h[b][u],void 0===(f=t.tiles.find((function(e){return e.id===p})))&&(f=s),g=!1,((i=c>=(i+1)*r?i+1:i)+1)%n===0&&l.length>0&&i+1<l.length*n&&(g=!0),e.next=8,V(f,a,d,n,r,i,g);case 8:c++;case 9:case"end":return e.stop()}}),e)})),m=0;case 14:if(!(m<h[b].length)){e.next=19;break}return e.delegateYield(g(m),"t0",16);case 16:m++,e.next=14;break;case 19:b++,e.next=11;break;case 22:p++,e.next=7;break;case 25:return e.abrupt("return",d);case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t,n,r){return G.apply(this,arguments)}function G(){return(G=Object(c.a)(o.a.mark((function e(t,n,r,a){var i,s;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Array(2*Math.ceil(t.tiles.length/r)),s=0,e.next=4,t.tiles.reduce(function(){var e=Object(c.a)(o.a.mark((function e(t,c,u){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return s=u>=(s+1)*r?s+1:s,e.next=5,V(c,a,i,n,r,s);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve());case 4:return e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V=function(){var e=Object(c.a)(o.a.mark((function e(t,n,r,a,i,c){var s,u,l,d,p,f,h,b,g,m,v,w,k,j=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=j.length>6&&void 0!==j[6]&&j[6],u=J(t,n),l=u.label,d=u.image,p=2*c,f="",h=d,d.startsWith("data:")&&!d.startsWith("data:image/svg+xml")&&!d.startsWith("data:image/png")){e.next=20;break}return b=d,g={},t.backgroundColor&&(g.backgroundColor=t.backgroundColor),t.borderColor&&(g.borderColor=t.borderColor),e.prev=10,e.next=13,L(b,g);case 13:h=e.sent,e.next=20;break;case 16:e.prev=16,e.t0=e.catch(10),console.log(e.t0.message),h=y.i;case 20:return f={image:h,alignment:"center",width:"100"},m={text:l,alignment:"center"},11===i||12===i||a>=6?(f.width="59",m.fontSize=9):9===i||10===i||5===a?f.width="70":7!==i&&8!==i||(f.width="90"),v=Z(),k={},v.labelPosition&&v.labelPosition===x.f?(w=f,k=m):v.labelPosition&&v.labelPosition===x.e?(k=f,w=m):(w={text:" "},k=f),s&&(k.pageBreak="after"),r[p]?(r[p].push(w),r[p+1].push(k)):(r[p]=[w],r[p+1]=[k]),e.abrupt("return",r);case 29:case"end":return e.stop()}}),e,null,[[10,16]])})));return function(t,n,r,a,o,i){return e.apply(this,arguments)}}(),Z=function(){return Object(j.b)().getState().app.displaySettings},q=function(){return h()().format("YYYY-MM-DD_HH-mm-ss-")};function Q(e,t){return X.apply(this,arguments)}function X(){return(X=Object(c.a)(o.a.mark((function e(t,n){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",O.isArray(t)?te(t,n):$(t,n));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){return ee.apply(this,arguments)}function ee(){return(ee=Object(c.a)(o.a.mark((function e(t,n){var r,a,i,c;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R({[t.id]:t},t,n,{embed:!0});case 2:r=e.sent,a=r.obf,(i=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}))&&(c=q()+t.name+" ",Object(k.c)()?(Object(k.i)(),Object(k.j)("Download/"+c+"board.obf",i)):Object(w.saveAs)(i,c+"board.obf"));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(){return ne.apply(this,arguments)}function ne(){return(ne=Object(c.a)(o.a.mark((function e(){var t,n,r,a,i,c,s,u,d,p,f,h=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=h.length>0&&void 0!==h[0]?h[0]:[],n=h.length>1?h[1]:void 0,r=t.length,a={},i={},c=new l.a,s=t.reduce((function(e,t){return e[t.id]=t,e}),{}),u=o.a.mark((function e(r){var u,l,d,p,f;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t[r],l="boards/".concat(u.id,".obf"),e.next=4,R(s,u,n,{embed:!1});case 4:if(d=e.sent,p=d.obf,f=d.images,p){e.next=9;break}return e.abrupt("return","continue");case 9:c.file(l,JSON.stringify(p,null,2)),Object.keys(f).forEach((function(e){var t=f[e],n="images/".concat(t.path);c.file(n,t.ab),i[e]=n})),a[u.id]=l;case 13:case"end":return e.stop()}}),e)})),d=0;case 9:if(!(d<r)){e.next=17;break}return e.delegateYield(u(d),"t0",11);case 11:if("continue"!==e.t0){e.next=14;break}return e.abrupt("continue",14);case 14:d++,e.next=9;break;case 17:p=a.root?a.root:a[Object.keys(s)[0]],f={format:"open-board-0.1",root:p,paths:{boards:a,images:i}},c.file("manifest.json",JSON.stringify(f,null,2)),c.generateAsync(y.f).then((function(e){if(e){var n=q();if(1===t.length?n=n+t[0].name+" ":n+="boardsset ",Object(k.c)()){Object(k.i)();var r="Download/"+n+y.h.openboard.filename;Object(k.j)(r,e)}else Object(w.saveAs)(e,n+y.h.openboard.filename)}}));case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e,t){for(var n=O.fromPairs(O.map(e,(function(e){return[e.id,e]}))),r=[t],a=[t];!O.isEmpty(r);){var o=r.pop(),i=O.get(n[o],"tiles");O.forEach(i,(function(e){var t=e.loadBoard;t&&!O.includes(a,t)&&(a.push(t),r.push(t))}))}return O.map(a,(function(e){return n[e]}))}function ae(){return oe.apply(this,arguments)}function oe(){return(oe=Object(c.a)(o.a.mark((function e(){var t,n,r,a,i,c,s,u=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=u.length>0&&void 0!==u[0]?u[0]:[],n=u.length>1?u[1]:void 0,r=n?re(t,n.id):t,(a=new Blob([JSON.stringify(r)],{type:"text/json;charset=utf-8;"}))&&(i=q(),1===r.length?i=i+r[0].name+" ":i+="boardsset ",Object(k.c)()&&(Object(k.i)(),c="Download/"+i+y.h.cboard.filename,Object(k.j)(c,a)),navigator.msSaveBlob?navigator.msSaveBlob(a,i+y.h.cboard.filename):((s=document.createElement("a")).href=window.URL.createObjectURL(a),s.setAttribute("download",i+y.h.cboard.filename),document.body.appendChild(s),s.click(),document.body.removeChild(s)));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ie(){return ce.apply(this,arguments)}function ce(){return(ce=Object(c.a)(o.a.mark((function e(){var t,n,r,a,i,s,u,l=arguments;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:[],n=l.length>1?l[1]:void 0,r={pageSize:"A4",pageOrientation:"landscape",pageMargins:[20,20],content:[]},a=t.length-1,e.next=6,t.reduce(function(){var e=Object(c.a)(o.a.mark((function e(t,r,i){var c,s,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:return c=e.sent,s=i!==a,e.next=6,Y(r,n,s);case 6:return u=e.sent,e.abrupt("return",c.concat(u));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Promise.resolve([]));case 6:i=e.sent,r.content=i,(s=g.a.createPdf(r))&&(u=q(),2===i.length?u=u+i[0]+" ":u+="boardsset ",Object(k.c)()?(Object(k.i)(),s.getBuffer((function(e){var t=new Blob([e],{type:"application/pdf"}),n="Download/"+u+y.h.pdf.filename;Object(k.j)(n,t)}))):s.download(u+y.h.pdf.filename));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}t.default={openboardExportAdapter:Q,cboardExportAdapter:ae,pdfExportAdapter:ie}}}]);
//# sourceMappingURL=3.d02ba0a7.chunk.js.map